require=function e(t,i,n){function o(r,c){if(!i[r]){if(!t[r]){var l="function"==typeof require&&require;if(!c&&l)return l(r,!0);if(s)return s(r,!0);var a=new Error("Cannot find module '"+r+"'");throw a.code="MODULE_NOT_FOUND",a}var h=i[r]={exports:{}};t[r][0].call(h.exports,function(e){var i=t[r][1][e];return o(i||e)},h,h.exports,e,t,i,n)}return i[r].exports}for(var s="function"==typeof require&&require,r=0;r<n.length;r++)o(n[r]);return o}({bezier:[function(e,t,i){"use strict";cc._RF.push(t,"87899xBqgBDK7wr+PI6wwqX","bezier");t.exports=function(e,t,i){function n(e,t){this.x=e||0,this.y=t||0}function o(e,t){for(var i=new n,o=e.length,s=0;s<o;s++){var c=r(o-1,s,t);i.x+=e[s].x*c,i.y+=e[s].y*c}return i}function s(e,t,i){var n,s;for(n=1/(t-1),s=0;s<t;s++)i[s]=o(e,s*n)}function r(e,t,i){return c(e,t)*Math.pow(i,t)*Math.pow(1-i,e-t)}function c(e,t){return l(e)/(l(t)*l(e-t))}function l(e){for(var t=1,i=1;i<=e;i++)t*=i;return t}var a={},h=e,d=i,f=t;return a.getPoints=function(e){var t=[],i=f;return e&&(i=e),s(h,i,t),t},a.getPoint=function(e){if(e>d)return console.log("time is out"),null;for(var t=new n,i=h.length,o=0;o<i;o++){var s=r(i-1,o,e/d);t.x+=h[o].x*s,t.y+=h[o].y*s}return t},a},cc._RF.pop()},{}],defines:[function(e,t,i){"use strict";cc._RF.push(t,"39403lWwkVFR7llQDVgNbt+","defines");var n={};n.configMap={bezierConfig:"configs/bezier-config.json",fishConfig:"configs/fish-config.json",fishGroupConfig:"configs/fish-group-config.json"},t.exports=n,cc._RF.pop()},{}],"editor-ui":[function(e,t,i){"use strict";cc._RF.push(t,"5194ajnc85F/b/kVbGuSn/2","editor-ui"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){this.isDown=!0},buttonClick:function(e,t){switch(t){case"upDown":this.upDown(e)}},upDown:function(e){var t="up",i=520;this.isDown?(t="down",i=520,this.isDown=!1):(t="up",i=-520,this.isDown=!0);var n=cc.moveTo(.3,this.node.position.x,this.node.position.y+i);this.node.runAction(n),e.target.getChildByName("Label").getComponent(cc.Label).string=t}}),cc._RF.pop()},{}],"editor-world":[function(e,t,i){"use strict";cc._RF.push(t,"8114bQHNy9FQZnE1kP8whTU","editor-world");var n=e("./../utility/math/bezier"),o=e("./../defines"),s=e("./../global");cc.Class({extends:cc.Component,properties:{pointPrefab:{default:null,type:cc.Prefab},controlPointPrefab:{default:null,type:cc.Prefab},scrollView:{default:null,type:cc.ScrollView},scrollViewContent:{default:null,type:cc.Node},scrollViewCellPrefab:{default:null,type:cc.Prefab}},onLoad:function(){var e=this;this.bezier=void 0,this.pointPool=[],this.controlPointList=[],this.linePointList=[],this.bezierConfig=void 0;var t=void 0;this.node.on(cc.Node.EventType.TOUCH_START,function(i){console.log("touch start");for(var n in e.controlPointList){var o=e.controlPointList[n];cc.pDistance(o.position,e.node.parent.convertTouchToNodeSpace(i))<10&&(t=o)}}),this.node.on(cc.Node.EventType.TOUCH_MOVE,function(i){t&&(t.position=e.node.parent.convertTouchToNodeSpace(i))}),this.node.on(cc.Node.EventType.TOUCH_END,function(i){if(void 0===t){var n=e.node.parent.convertTouchToNodeSpace(i);e.addPoint(n)}else t=void 0}),cc.loader.loadRes(o.configMap.bezierConfig,function(t,i){t&&console.log("load bezier config err = "+t),e.bezierConfig=i,e.initScrollView(i);var n=Object.keys(i)[0];e.showBezier(n)}),s.event.on("choose_bezier",this.showBezier.bind(this))},addPoint:function(e){console.log("pos = "+JSON.stringify(e));var t=cc.instantiate(this.controlPointPrefab);t.parent=this.node.parent,t.position=e,this.controlPointList.push(t)},update:function(e){if(0!==this.controlPointList.length){var t=n(this.controlPointList,200,10).getPoints();for(var i in this.linePointList)this.node.removeChild(this.linePointList[i]);this.linePointList=[];for(var o=0;o<t.length;o++){var s=void 0;o<this.pointPool.length?s=this.pointPool[o]:(s=cc.instantiate(this.pointPrefab),this.pointPool.push(s)),s.parent=this.node,s.position=t[o],this.linePointList.push(s)}}},buttonClick:function(e,t){switch(t){case"build":if(console.log("保存"),cc.sys.isBrowser){console.log("浏览器"),this.saveBezier();var i=JSON.stringify(this.bezierConfig),n=new Blob([i],{type:"application/json"}),o=document.createElement("a");o.download="bezier-config.json",o.innerHTML="Download File",null!=window.webkitURL?o.href=window.webkitURL.createObjectURL(n):(o.href=window.URL.createObjectURL(n),o.onclick=destroyClickedElement,o.style.display="none",document.body.appendChild(o)),o.click()}break;case"save":this.saveBezier();break;case"new":this.newBezier();break;case"delete":this.removeControllerPoint(),this.removeScrollViewCell(this.currentBezierId);var s={};for(var r in this.bezierConfig)r!==this.currentBezierId&&(s[r]=this.bezierConfig[r]);this.bezierConfig=s,this.currentBezierId=void 0,console.log("bezier config = "+JSON.stringify(this.bezierConfig))}},newBezier:function(){var e="bezier_id_1";console.log("str = "+e);var t=this.getDeletion(this.bezierConfig);console.log("num = "+t);var i=e.substring(0,10)+t;this.bezierConfig[i]=[],console.log("new bezier id = "+i),this.addScrollViewCell(i),this.showBezier(i)},getDeletion:function(e){var t=Object.keys(e);t.sort(function(e,t){return parseInt(e.substring(10,e.length))>parseInt(t.substring(10,t.length))});for(var i=0;i<t.length;i++)if(i!==parseInt(t[i].substring(10,t[i].length)))return i;return t.length},saveBezier:function(){if(void 0!==this.currentBezierId){for(var e=[],t=0;t<this.controlPointList.length;t++)e.push({x:this.controlPointList[t].position.x,y:this.controlPointList[t].position.y});this.bezierConfig[this.currentBezierId]=e}},showBezier:function(e){console.log("show bezier id = "+e);var t=e;this.currentBezierId=t;var i=this.bezierConfig[t];console.log("pos list = "+i.length),this.removeControllerPoint();for(var n=0;n<i.length;n++)this.addPoint(i[n])},initScrollView:function(e){for(var t in e)this.addScrollViewCell(t)},addScrollViewCell:function(e){console.log(" i = "+e);var t=cc.instantiate(this.scrollViewCellPrefab);this.scrollViewContent.addChild(t),t.position=cc.p(0,40*-this.scrollViewContent.children.length),t.getComponent("scroll-view-cell").init({bezierId:e})},removeScrollViewCell:function(e){for(var t=0;t<this.scrollViewContent.children.length;t++){var i=this.scrollViewContent.children[t];i.getComponent("scroll-view-cell").getCellId()===e&&this.scrollViewContent.removeChild(i)}for(var n=0;n<this.scrollViewContent.children.length;n++)this.scrollViewContent.children[n].position=cc.p(0,40*-(n+1))},removeControllerPoint:function(){for(var e=0;e<this.controlPointList.length;e++)this.controlPointList[e].destroy();for(var t=0;t<this.linePointList.length;t++)this.node.removeChild(this.linePointList[t]);this.controlPointList=[]}}),cc._RF.pop()},{"./../defines":"defines","./../global":"global","./../utility/math/bezier":"bezier"}],"event-listener":[function(e,t,i){"use strict";cc._RF.push(t,"0fd0cxIdypG9o+EoCu6lMJy","event-listener");t.exports=function(e){var t={};return e.on=function(e,i){t.hasOwnProperty(e)?t[e].push(i):t[e]=[i]},e.fire=function(e){if(t.hasOwnProperty(e))for(var i=t[e],n=0;n<i.length;n++){for(var o=[],s=i[n],r=1;r<arguments.length;r++)o.push(arguments[r]);s.apply(this,o)}},e.removeListener=function(e,i){if(t.hasOwnProperty(e))for(var n=t[e],o=n.length-1;o>=0;o--)n[o]===i&&n.splice(o,1)},Object.removeAllListeners=function(){t={}},e},cc._RF.pop()},{}],"fish-control":[function(e,t,i){"use strict";cc._RF.push(t,"31ca4JGNFZE0Z9pM5vPOx8C","fish-control");var n=e("./../defines"),o={Invalide:-1,RandomFish:1,ArrayFish:2};cc.Class({extends:cc.Component,properties:{},onLoad:function(){var e=this;this.addRandomFishTime=0,this.stateAddFish=0,this.addFishStateTime=0;var t=0;for(var i in n.configMap)!function(i){cc.loader.loadRes(i,function(s,r){s&&cc.log("load err "+i+" = "+s),e[i]=r,++t===Object.keys(n.configMap).length&&(cc.log("系统加载完毕"),e.setAddFishState(o.RandomFish))})}(n.configMap[i])},update:function(e){switch(this.addFishStateTime+=e,this.stateAddFish){case o.RandomFish:this.addRandomFish(e),this.addFishStateTime>10&&(this.addFishStateTime=0,this.setAddFishState(o.ArrayFish));break;case o.ArrayFish:this.addFishStateTime>10&&(this.addFishStateTime=0,this.setAddFishState(o.RandomFish))}},addRandomFish:function(e){if(this.addRandomFishTime+=e,this.addRandomFishTime>1){this.addRandomFishTime=0;var t=this[n.configMap.fishGroupConfig],i=Object.keys(t),o=Math.floor(Math.random()*i.length);cc.log("fishGroudId = "+i[o]),this.addFishGroup(t[i[o]])}},addFishGroup:function(e){var t=e.fish_type,i=e.array,o=t[Math.floor(Math.random()*t.length)];cc.log("fish type = "+o);var s=this[n.configMap.bezierConfig];console.log("bezier config = "+JSON.stringify(s));var r=s[Object.keys(s)[Math.floor(Math.random()*Object.keys(s).length)]];cc.log("bezier id = "+JSON.stringify(r)),this.addOneFish(o,i,r)},addOneFish:function(e,t,i){for(var o=this[n.configMap.fishConfig][e],s=0;s<t.length;s++){var r=[];for(var c in i)r.push({x:i[c].x+t[s].x*o.width,y:i[c].y+t[s].y*o.height});var l={config:o,bezier:r};this.getComponent("game-manager").addFishNode(l)}},setAddFishState:function(e){this.stateAddFish!==e&&(this.stateAddFish=e)}}),cc._RF.pop()},{"./../defines":"defines"}],fish:[function(e,t,i){"use strict";cc._RF.push(t,"343bdHcjtNL9Z3sdk+gt6iu","fish");var n=function(e){return e&&e.__esModule?e:{default:e}}(e("./../utility/math/bezier")),o={Invalid:-1,Run:1,RunFast:2,Dead:3};cc.Class({extends:cc.Component,properties:{spriteAtlas:{default:null,type:cc.SpriteAtlas}},onLoad:function(){this.state=o.Invalid,this.runTime=0},initWithData:function(e){for(var t=e.config,i=e.bezier,s=this.getComponent(cc.Animation),r=["run","dead"],c=t.animates,l=0;l<r.length;l++){var a=this.getSpriteFrameList(c[r[l]]);cc.log("sprite frame list = "+a.length);var h=cc.AnimationClip.createWithSpriteFrames(a,5);"run"===r[l]&&(h.wrapMode=cc.WrapMode.Loop),s.defaultClip=h,s.addClip(h,r[l])}this.bezier=(0,n.default)(i,100,10),this.setState(o.Run)},getSpriteFrameList:function(e){for(var t=e.pre,i=e.start,n=e.end,o=[],s=i;s<n+1;s++){var r=t+"_"+s;cc.log("str = "+r);var c=this.spriteAtlas.getSpriteFrame(r);o.push(c)}return o},setState:function(e){if(this.state!==e){switch(e){case o.Invalid:break;case o.Run:this.node.position=this.bezier.getPoint(0),this.getComponent(cc.Animation).play("run")}this.state=e}},update:function(e){switch(this.runTime+=e,this.state){case o.Run:var t=this.bezier.getPoint(this.runTime),i=cc.pAngle(cc.p(0,0),cc.pSub(t,this.node.position));cc.log("direction = "+JSON.stringify(i)),this.node.position=t}}}),cc._RF.pop()},{"./../utility/math/bezier":"bezier"}],"game-manager":[function(e,t,i){"use strict";cc._RF.push(t,"817f8YnCM9MNqVde+PXnBsM","game-manager");e("./global");cc.Class({extends:cc.Component,properties:{fishPrefab:{default:null,type:cc.Prefab}},onLoad:function(){},update:function(e){},addFishNode:function(e){var t=cc.instantiate(this.fishPrefab);t.parent=this.node,t.getComponent("fish").initWithData(e)}}),cc._RF.pop()},{"./global":"global"}],global:[function(e,t,i){"use strict";cc._RF.push(t,"1b60eM5TnlAGp6KPXIVbbvY","global");var n=function(e){return e&&e.__esModule?e:{default:e}}(e("./utility/event-listener")),o={};o.event=(0,n.default)({}),t.exports=o,cc._RF.pop()},{"./utility/event-listener":"event-listener"}],"point-cell":[function(e,t,i){"use strict";cc._RF.push(t,"1e543VJ9s9PlalSNBIGaxf4","point-cell"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){}}),cc._RF.pop()},{}],"scroll-view-cell":[function(e,t,i){"use strict";cc._RF.push(t,"e7098I3X/VPr6Tis2m4gzS9","scroll-view-cell");var n=e("./../global");cc.Class({extends:cc.Component,properties:{checkButton:{default:null,type:cc.Toggle},label:{default:null,type:cc.Label}},onLoad:function(){n.event.on("choose_bezier",this.chooseBezier.bind(this)),this.checkButton.interactable=!1},chooseBezier:function(e){console.log("选中了一条曲线"+e),this.checkButton.isChecked=!1,e===this.bezierId&&(this.checkButton.isChecked=!0)},init:function(e){this.bezierId=e.bezierId,this.label.string=this.bezierId},onButtonClick:function(e,t){n.event.fire("choose_bezier",this.bezierId)},getCellId:function(){return this.bezierId}}),cc._RF.pop()},{"./../global":"global"}]},{},["editor-ui","editor-world","point-cell","scroll-view-cell","defines","game-manager","fish-control","fish","global","event-listener","bezier"]);